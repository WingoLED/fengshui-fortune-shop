<% const nav = (typeof nav !== 'undefined' ? nav : []); %>
<% const settings = (typeof settings !== 'undefined' ? settings : {}); %>
<% const displayTip = tip; %>

<section class="hero mb-4">
  <div class="p-5 mb-4 bg-light rounded-3 hero-inner">
    <div class="container-fluid py-5">
      <h1 class="display-5 fw-bold">Harmony, Growth, and Positive Energy</h1>
      <p class="col-md-8 fs-5">Discover curated feng shui ornaments, personal guidance, and household services. Align your space with the five elements.</p>
      <div class="mt-3">
        <a href="/products" class="btn btn-success btn-lg me-2">Shop Ornaments</a>
        <a href="/book" class="btn btn-outline-secondary btn-lg">Book Consultation</a>
      </div>
      <% if (!user) { %>
        <div class="mt-3">
          <a href="/register" class="btn btn-outline-success btn-sm">Register</a>
          <a href="/login" class="btn btn-outline-primary btn-sm">Login</a>
        </div>
      <% } %>
    </div>
  </div>
</section>

<section class="mb-5">
  <h2>Featured Products</h2>
  <div class="row">
    <% (products || []).forEach(p => { %>
      <div class="col-md-4 mb-3">
        <div class="card h-100">
          <img src="<%= p.imageUrl %>" class="card-img-top" alt="<%= p.name %>">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><%= p.name %></h5>
            <p class="card-text"><%= p.description %></p>
            <div class="mt-auto">
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold">$<%= p.price.toFixed(2) %></span>
                <div>
                  <% if (user) { %>
                    <button class="btn btn-sm btn-outline-success favorite-toggle" data-product-id="<%= p.id %>">â™¥ Favorite</button>
                  <% } %>
                </div>
              </div>
              <small class="text-muted">Stock: <%= p.stock %></small>
            </div>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</section>

<section class="mb-5">
  <h2>Services</h2>
  <div class="row">
    <div class="col-md-4 mb-3">
      <div class="p-3 border rounded h-100">
        <h5>Feng Shui Ornaments Design</h5>
        <p>Custom design services tailored to your goals and space.</p>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="p-3 border rounded h-100">
        <h5>Personal Guidance</h5>
        <p>One-on-one consultations to harmonize your energy and intentions.</p>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="p-3 border rounded h-100">
        <h5>Household Feng Shui</h5>
        <p>On-site or virtual home consultations to optimize flow and balance.</p>
      </div>
    </div>
  </div>
</section>

<section class="mb-5">
  <h2>Feng Shui Tips</h2>
  <p>Explore curated articles and resources.</p>
  <a class="btn btn-outline-primary" href="/tips">Browse Tips</a>
</section>

<!-- Daily Tip Pop-up -->
<% if (displayTip) { %>
  <div id="dailyTipModal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Daily Feng Shui Tip</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6><%= displayTip.title %></h6>
          <p><%= displayTip.body %></p>
          <% if (displayTip.videoUrl) { %>
            <div class="ratio ratio-16x9">
              <iframe src="<%= displayTip.videoUrl %>" title="Feng Shui Tip Video" allowfullscreen></iframe>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Show if not seen today
    (function(){
      const key = 'fsfs_daily_tip_seen';
      const today = new Date().toISOString().slice(0,10);
      if (localStorage.getItem(key) !== today) {
        const modalEl = document.getElementById('dailyTipModal');
        if (modalEl) {
          const modal = new bootstrap.Modal(modalEl);
          modal.show();
          localStorage.setItem(key, today);
        }
      }
    })();
  </script>
<% } %>
